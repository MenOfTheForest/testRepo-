<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>SpeedFest - React Frontend</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; }
        .navbar { box-shadow: 0 2px 4px rgba(0,0,0,.1); }
        .card { box-shadow: 0 2px 4px rgba(0,0,0,.1); margin-bottom: 20px; }
        .table th { background-color: #343a40; color: white; }
        .loading { text-align: center; padding: 20px; }
        .error { color: #dc3545; }
        .success { color: #28a745; }
    </style>
</head>
<body>
    <nav class="navbar navbar-dark bg-dark">
        <div class="container">
            <span class="navbar-brand">üèéÔ∏è SpeedFest</span>
            <span class="navbar-text">Formula 1 Racing Data Management</span>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row">
            <div class="col-12">
                <div class="alert alert-info">
                    <h4>üöÄ React Frontend Status</h4>
                    <p><strong>React app is being installed...</strong> This may take a few minutes.</p>
                    <p>In the meantime, you can test the API using this temporary interface or the Swagger UI at <a href="http://localhost:5000/swagger" target="_blank">http://localhost:5000/swagger</a></p>
                </div>
            </div>
        </div>

        <!-- Tabs -->
        <ul class="nav nav-tabs" id="mainTab" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="teams-tab" data-bs-toggle="tab" data-bs-target="#teams" type="button" role="tab">Racing Teams</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="drivers-tab" data-bs-toggle="tab" data-bs-target="#drivers" type="button" role="tab">Drivers</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="laptimes-tab" data-bs-toggle="tab" data-bs-target="#laptimes" type="button" role="tab">Lap Times</button>
            </li>
        </ul>

        <div class="tab-content" id="mainTabContent">
            <!-- Teams Tab -->
            <div class="tab-pane fade show active" id="teams" role="tabpanel">
                <div class="card mt-3">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5>Racing Teams</h5>
                        <button class="btn btn-primary" onclick="loadTeams()">Refresh</button>
                    </div>
                    <div class="card-body">
                        <div id="teams-loading" class="loading">Click Refresh to load teams...</div>
                        <div id="teams-content"></div>
                    </div>
                </div>
            </div>

            <!-- Drivers Tab -->
            <div class="tab-pane fade" id="drivers" role="tabpanel">
                <div class="card mt-3">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5>Racing Drivers</h5>
                        <button class="btn btn-primary" onclick="loadDrivers()">Refresh</button>
                    </div>
                    <div class="card-body">
                        <div id="drivers-loading" class="loading">Click Refresh to load drivers...</div>
                        <div id="drivers-content"></div>
                    </div>
                </div>
            </div>

            <!-- Lap Times Tab -->
            <div class="tab-pane fade" id="laptimes" role="tabpanel">
                <div class="card mt-3">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5>Fastest Lap Times</h5>
                        <button class="btn btn-primary" onclick="loadLapTimes()">Refresh</button>
                    </div>
                    <div class="card-body">
                        <div id="laptimes-loading" class="loading">Click Refresh to load lap times...</div>
                        <div id="laptimes-content"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const API_BASE = 'https://localhost:49796';  // Default HTTPS port from launchSettings.json

        async function apiCall(endpoint) {
            try {
                const response = await fetch(`${API_BASE}${endpoint}`);
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                return await response.json();
            } catch (error) {
                console.error('API Error:', error);
                throw error;
            }
        }

        async function loadTeams() {
            const loading = document.getElementById('teams-loading');
            const content = document.getElementById('teams-content');
            
            loading.innerHTML = 'Loading teams...';
            content.innerHTML = '';
            
            try {
                const teams = await apiCall('/api/racingteams');
                loading.style.display = 'none';
                
                let html = '<table class="table table-striped"><thead><tr><th>ID</th><th>Name</th><th>Team Principal</th><th>Drivers</th></tr></thead><tbody>';
                teams.forEach(team => {
                    html += `<tr>
                        <td>${team.racingTeamId}</td>
                        <td>${team.name}</td>
                        <td>${team.teamPrincipal}</td>
                        <td>${team.drivers.length} drivers</td>
                    </tr>`;
                });
                html += '</tbody></table>';
                content.innerHTML = html;
            } catch (error) {
                loading.innerHTML = `<div class="error">Error loading teams: ${error.message}</div>`;
            }
        }

        async function loadDrivers() {
            const loading = document.getElementById('drivers-loading');
            const content = document.getElementById('drivers-content');
            
            loading.innerHTML = 'Loading drivers...';
            content.innerHTML = '';
            
            try {
                const drivers = await apiCall('/api/racingdrivers');
                loading.style.display = 'none';
                
                let html = '<table class="table table-striped"><thead><tr><th>ID</th><th>Name</th><th>Number</th><th>Team</th></tr></thead><tbody>';
                drivers.forEach(driver => {
                    html += `<tr>
                        <td>${driver.racingDriverId}</td>
                        <td>${driver.name}</td>
                        <td>#${driver.driverNumber}</td>
                        <td>${driver.teamName}</td>
                    </tr>`;
                });
                html += '</tbody></table>';
                content.innerHTML = html;
            } catch (error) {
                loading.innerHTML = `<div class="error">Error loading drivers: ${error.message}</div>`;
            }
        }

        async function loadLapTimes() {
            const loading = document.getElementById('laptimes-loading');
            const content = document.getElementById('laptimes-content');
            
            loading.innerHTML = 'Loading fastest lap times...';
            content.innerHTML = '';
            
            try {
                const lapTimes = await apiCall('/api/laptimes/fastest?count=10');
                loading.style.display = 'none';
                
                let html = '<table class="table table-striped"><thead><tr><th>Rank</th><th>Driver</th><th>Team</th><th>Total Time</th><th>Sector 1</th><th>Sector 2</th><th>Sector 3</th></tr></thead><tbody>';
                lapTimes.forEach((lapTime, index) => {
                    const rank = index + 1;
                    const medal = rank === 1 ? 'ü•á' : rank === 2 ? 'ü•à' : rank === 3 ? 'ü•â' : rank;
                    html += `<tr>
                        <td>${medal}</td>
                        <td>${lapTime.driverName}</td>
                        <td>${lapTime.teamName}</td>
                        <td><strong>${lapTime.totalLapTime ? lapTime.totalLapTime.toFixed(3) + 's' : 'N/A'}</strong></td>
                        <td>${lapTime.sector1ElapsedTime ? lapTime.sector1ElapsedTime.toFixed(3) + 's' : 'N/A'}</td>
                        <td>${lapTime.sector2ElapsedTime ? lapTime.sector2ElapsedTime.toFixed(3) + 's' : 'N/A'}</td>
                        <td>${lapTime.sector3ElapsedTime ? lapTime.sector3ElapsedTime.toFixed(3) + 's' : 'N/A'}</td>
                    </tr>`;
                });
                html += '</tbody></table>';
                content.innerHTML = html;
            } catch (error) {
                loading.innerHTML = `<div class="error">Error loading lap times: ${error.message}</div>`;
            }
        }

        // Auto-load teams when page loads
        document.addEventListener('DOMContentLoaded', function() {
            loadTeams();
            
            // Add event listeners to tabs to auto-load data when switching
            document.getElementById('teams-tab').addEventListener('click', function() {
                loadTeams();
            });
            
            document.getElementById('drivers-tab').addEventListener('click', function() {
                const content = document.getElementById('drivers-content');
                // Only load if not already loaded
                if (content.innerHTML === '') {
                    loadDrivers();
                }
            });
         
            document.getElementById('laptimes-tab').addEventListener('click', function() {
                const content = document.getElementById('laptimes-content');
                // Only load if not already loaded
                if (content.innerHTML === '') {
                    loadLapTimes();
                }
            });
        });
    </script>
</body>
</html>